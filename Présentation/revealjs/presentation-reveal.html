<!doctype html>
<html lang="fr">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GeoChallenge Tracker ‚Äî Soutenance</title>
    <link rel="stylesheet" href="https://unpkg.com/reveal.js/dist/reveal.css" />
    <link rel="stylesheet" href="https://unpkg.com/reveal.js/dist/theme/league.css" id="theme" />
    <style>
        .reveal section h1,
        .reveal section h2 {
            text-transform: none;
        }

        .reveal .slides {
            font-size: 30px;
        }

        .reveal ul {
            line-height: 1.3;
        }

        .logo-placeholder {
            width: 140px;
            height: 140px;
            border: 2px dashed #999;
            border-radius: 12px;
            display: inline-block;
            line-height: 140px;
            text-align: center;
            color: #999;
            font-size: 20px;
        }

        .credits {
            font-size: 22px;
            color: #555;
            margin-top: 1rem;
        }
    </style>

    <link rel="stylesheet" href="presentation-reveal.css" />
</head>

<body>
    <div class="reveal">
        <div class="brand-header">
            <div class="brand-logo"></div>
            <div class="brand-name">GeoChallenge Tracker</div>
        </div>
        <div class="brand-footer"></div>
        <div class="slides">

            <section>
                <h1><span class="logo-wrapper"><img class="logo" src="assets/logo-cropped.svg"
                            alt="" /></span>GeoChallenge
                    Tracker</h1>
                <div class="credits">
                    <div>Jean Ceugniet</div>
                    <div>Titre Concepteur D√©veloppeur d'Applications, 28 octobre 2025</div>
                </div>
                <aside class="notes">
                    Identit√© produit<br>
                    Contexte
                </aside>
            </section>

            <section>
                <h2>Pr√©sentation entreprise / client</h2>
                <ul>
                    <li class="fragment diapo__item">Communaut√© : <span class="diapo__item__content">g√©ocacheurs</span>
                    </li>
                    <li class="fragment diapo__item">Client : <span class="diapo__item__content">passionn√©s de
                            challenges</span></li>
                    <li class="fragment diapo__item">Pool tests : <span class="diapo__item__content">12 testeurs,
                            profils vari√©s</span></li>
                </ul>
                <aside class="notes">
                    Insister sur le jeu dans le jeu<br>
                    Expliquer la complexit√© de suivi : dur√©e et volume
                </aside>
            </section>

            <section>
                <h2>Existant, besoins, contraintes, livrables</h2>
                <ul>
                    <li class="fragment diapo__item">Existant : <span class="diapo__item__content"><a class="dialog_toggler" href="#dialog_03_existant">forces,
                            faiblesses</a></span></li>
                    <li class="fragment diapo__item">Besoin : <span class="diapo__item__content">ergonomie,
                            fonctionnalit√©s, performance</span></li>
                    <li class="fragment diapo__item">Contraintes : <span class="diapo__item__content">deadline
                            10/10/2025, mobile-first, limites APIs externes, plateforme de test</span></li>
                    <li class="fragment diapo__item">Livrables : <span class="diapo__item__content">dossier projet +
                            annexes, application web, documentation technique</span></li>
                </ul>
                <aside class="notes">
                    Existant : Force exhaustivit√© / Faiblesse densit√© d'information / <br>
                    Contraintes : importance du respect des limites APIs externes
                </aside>
                <dialog class="dialog" id="dialog_03_existant">
                    <h3 class="dialog__title">Project GC</h3>
                    <div class="dialog__content">
                        <img src="assets/03/projectgc.png" alt="ProjectGC, dashboard" />
                    </div>
                </dialog>
            </section>

            <section>
                <h2>Gestion de projet</h2>
                <ul>
                    <li class="fragment diapo__item">Agile solo : <span class="diapo__item__content">sprints 1 semaine
                            (x10), MoSCoW, revues</span></li>
                    <li class="fragment diapo__item">Suivi : <span class="diapo__item__content"><a class="dialog_toggler" href="#dialog_04_github">GitHub Projects
                            (kanban)</a>, issues, milestones</span></li>
                    <li class="fragment diapo__item">Stack : <span class="diapo__item__content"><a class="dialog_toggler" href="#dialog_04_docker">Docker</a>, Python 3.11,
                            FastAPI, MongoDB, Vue.js</span></li>
                    <li class="fragment diapo__item">Qualit√© : <span class="diapo__item__content">CI/CD/CC, coverage,
                            P95</span></li>
                </ul>
                <aside class="notes">
                    MoSCoW : Must, Should, Could, Won't<br>
                    GitHub Projects : screenshots github projects, focaliser sur la diff√©rence <a
                        href="assets/04/github-roadmap.png">roadmap</a> / <a
                        href="assets/04/github-kanban.png">kanban</a><br>
                    Docker : <a href="assets/04/docker-compose.yml.txt">compose multi-services</a>
                </aside>
                <dialog class="dialog" id="dialog_04_github">
                    <h3 class="dialog__title">Github</h3>
                    <div class="dialog__content">
                        <h4>Vue roadmap</h4>
                        <img src="assets/04/github-roadmap.png" alt="Github, roadmap" />
                        <h4>Vue Kanban</h4>
                        <img src="assets/04/github-kanban.png" alt="Github, kanban" />        
                    </div>
                </dialog>
                <dialog class="dialog" id="dialog_04_docker">
                    <h3 class="dialog__title">Docker Compose</h3>
                    <div class="dialog__content">
                        <code>
                            <pre>
# ---------------------------
# üß± docker-compose.yml (optimis√© dev/prod)
# ---------------------------
services:
    backend:
    build:
        context: ./backend
        dockerfile: Dockerfile
    container_name: geo-backend
    ports:
        - "8000:8000"
    env_file:
        - .env
    environment:
        - MONGODB_USER=${MONGODB_USER}
        - MONGODB_PASSWORD=${MONGODB_PASSWORD}
        - MONGODB_URI_TPL=${MONGODB_URI_TPL}
        - MONGODB_DB=${MONGODB_DB}
        - JWT_SECRET_KEY=${JWT_SECRET_KEY}
        - SMTP_HOST=${SMTP_HOST}
        - SMTP_PORT=${SMTP_PORT}
        - BACKUP_DIR=/backups
    depends_on:
        - maildev
    volumes:
        - ./backend:/app
        - ./backups:/backups
        - ./backend/uploads:/app/uploads
        - ./backend/data/samples:/app/data/samples
        - ./.env:/app/.env
    restart: unless-stopped

    maildev:
    container_name: geo-maildev
    image: maildev/maildev
    ports:
        - "1080:1080"
        - "1025:1025"
    restart: unless-stopped

    # --- Frontend unifi√© avec variable d'environnement ---
    frontend:
    build:
        context: ./frontend
        dockerfile: Dockerfile
        target: ${DOCKER_TARGET:-dev}
        args:
        VITE_API_URL: ${VITE_API_URL:-/api}
        VITE_TILE_URL: ${VITE_TILE_URL:-/tiles/{z}/{x}/{y}.png}
    container_name: geo-frontend
    env_file:
        - .env
    environment:
        - CHOKIDAR_USEPOLLING=${CHOKIDAR_USEPOLLING:-true}
        - VITE_API_URL=${VITE_API_URL:-/api}
        - VITE_TILE_URL=${VITE_TILE_URL:-/tiles/{z}/{x}/{y}.png}
    depends_on:
        - backend
        - tiles
    ports:
        - "${FRONTEND_PORT:-5173}:${FRONTEND_INTERNAL_PORT:-5173}"
    volumes:
        - ./frontend:/app
        - /app/node_modules
    restart: unless-stopped

    # --- Service tiles (commun dev/prod) ---
    tiles:
    image: nginx:1.25-alpine
    container_name: geo-tiles
    restart: unless-stopped
    command: |
        sh -c "
        rm -f /etc/nginx/conf.d/default.conf &&
        mkdir -p /var/log/nginx /var/cache/nginx/tiles_cache &&
        nginx -g 'daemon off;'
        "
    volumes:
        # Configuration optimis√©e
        - ./ops/nginx/tiles.conf:/etc/nginx/conf.d/tiles.conf:ro
        # Sant√© + assets locaux
        - ./ops/nginx/www:/var/www:ro
        # Cache persistant avec permissions
        - tiles_cache:/var/cache/nginx/tiles_cache
        # Logs pour debug
        - tiles_logs:/var/log/nginx
    ports:
        - "8080:80"
    # Limite m√©moire pour √©viter les fuites
    deploy:
        resources:
        limits:
            memory: 512M
        reservations:
            memory: 256M
    # Sant√© du conteneur
    healthcheck:
        test: ["CMD-SHELL", "wget -q -O /dev/null http://127.0.0.1/tiles/_health.png || exit 1"]
        interval: 30s
        timeout: 3s
        retries: 3
        start_period: 10s

volumes:
    tiles_cache:
    driver: local
    tiles_logs:
    driver: local

# --- Commandes rapides ---
# D√©veloppement: docker-compose --profile dev up -d
# Production:    docker-compose --profile prod up -d
# Les deux:      docker-compose --profile dev --profile prod up -d
                            </pre>
                        </code>
                    </div>
                </dialog>
            </section>

            <section>
                <h2>Architecture logicielle</h2>
                <ul>
                    <li class="fragment diapo__item">3-tiers :<br>
                        <ul class="diapo__item__content">
                            <li><img src="assets/05/logo-vuejs.svg" alt="">Vue.js</li>
                            <li><img src="assets/05/logo-fastapi.svg" alt="">FastAPI</li>
                            <li><img src="assets/05/logo-mongodb.svg" alt="">MongoDB</li>
                        </ul>
                    </li>
                    <li class="fragment diapo__item">S√©paration claire : <span class="diapo__item__content"><a href="#dialog_archi_details"
                                class="dialog_toggler">routes /
                                services / mod√®les</a></span></li>
                    <li class="fragment diapo__item">Encapsulation des d√©pendances externes : <span
                            class="diapo__item__content">altim√©trie</span></li>
                </ul>

                <dialog class="dialog" id="dialog_archi_details">
                    <h3 class="dialog__title">Organisation du projet et conteneurs Docker</h3>

                    <div class="dialog__content grid_6 architecture">
                            <div class="docker frontend">
                                <div class="title">üíª Frontend</div>
                                <pre><code>frontend/
        ‚îú‚îÄ‚îÄ üìÇ public/
        ‚îú‚îÄ‚îÄ üì¶ src/
        ‚îÇ   ‚îú‚îÄ‚îÄ üß© components/
        ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ pages/
        ‚îÇ   ‚îú‚îÄ‚îÄ üß≠ router/
        ‚îÇ   ‚îî‚îÄ‚îÄ üìö store/
        ‚îî‚îÄ‚îÄ üß™ tests/
                        </code></pre>
                            </div>

                            <div class="docker backend">
                                <div class="title">üñ•Ô∏è Backend</div>
                                <pre><code>backend/
        ‚îú‚îÄ‚îÄ üì¶ app/
        ‚îÇ   ‚îú‚îÄ‚îÄ üîó api/routes/
        ‚îÇ   ‚îú‚îÄ‚îÄ üîß services/
        ‚îÇ   ‚îú‚îÄ‚îÄ üß± models/
        ‚îÇ   ‚îî‚îÄ‚îÄ üíæ db/
        ‚îú‚îÄ‚îÄ üß™ tests/
        ‚îî‚îÄ‚îÄ üì§ uploads/gpx/
                        </code></pre>
                            </div>

                            <div class="docker db">
                                <div class="title">üóÑÔ∏è Database</div>
                                <pre><code>
        ‚îú‚îÄ‚îÄ üìÅ collections/
        ‚îÇ   ‚îú‚îÄ‚îÄ caches
        ‚îÇ   ‚îú‚îÄ‚îÄ challenges
        ‚îÇ   ‚îú‚îÄ‚îÄ userChallenges
        ‚îÇ   ‚îî‚îÄ‚îÄ userChallengesTasks
                        </code></pre>
                            </div>

                            <div class="docker ops">
                                <div class="title">üõ†Ô∏è Ops</div>
                                <pre><code>ops/
        ‚îú‚îÄ‚îÄ üöÄ deploy/
        ‚îî‚îÄ‚îÄ üåç nginx/www/tiles/
                        </code></pre>
                            </div>

                            <div class="docker global">
                                <div class="title">üåê Global</div>
                                <pre><code>/
        ‚îú‚îÄ‚îÄ üíæ backups/
        ‚îÇ   ‚îú‚îÄ‚îÄ üßπ db_cleanup/
        ‚îÇ   ‚îî‚îÄ‚îÄ üì¶ full_backup/
        ‚îî‚îÄ‚îÄ üì§ uploads/gpx/
                        </code></pre>
                            </div>
                        </div>
                </dialog>

                <aside class="notes">
                    3-tiers : se pr√©parer aux questions sur le choix de la stack<br>
                    S√©paration : <a href="assets/05/folder.png">structure dossiers</a><br>
                    Encapsulation : abstraction == possibilit√© de changement de provider
                </aside>
            </section>


            <section>
                <h2>Maquettes &amp; encha√Ænement</h2>
                <ul>
                    <li class="fragment diapo__item">Screenshots : <span class="diapo__item__content"><a class="dialog_toggler" href="#dialog_06_maquettes">Accueil / Carte / Liste challenges</a></span></li>
                    <li class="fragment diapo__item">Charte : <span class="diapo__item__content">mobile-first, sobre,
                            lisible, performances</span></li>
                </ul>
                <dialog class="dialog" id="dialog_06_maquettes">
                    <h3 class="dialog__title">Maquettes &amp √©crans</h3>

                    <div class="dialog__content">
                        <h4>Accueil</h4>
                        <img src="assets/06/homepage-logged-full-split.png" alt="Accueil" />
                        <h4>Liste des challenges</h4>
                        <img src="assets/06/challenges-list.png" alt="Liste des challenges" />
                        <h4>Carte interactive</h4>
                        <img src="assets/06/interactive-map-mobile.png" alt="Map" />
                    </div>
                </dialog>
                <aside class="notes">
                    Screenshots : sobri√©t√© graphique assum√©e, on est sur un outil<br>
                    Encha√Ænements : <a href="assets/06/diagramme_enchainements.svg">diagramme des encha√Ænements</a>
                    Charte : <a
                        href="https://www.figma.com/proto/ba8qCI2QTFiJi3dkZAghaZ/Geocaching?node-id=0-1&t=09PPhu9lbqOrJfQR-1">lien
                        figma direct</a>
                </aside>

            </section>

            <section>
                <h2>Mod√®le de donn√©es</h2>
                <ul>
                    <li class="fragment diapo__item">Diagramme E/A : <span class="diapo__item__content"><a class="dialog_toggler" href="#dialog_07_ea_simple">simplifi√©</a> / <a class="dialog_toggler" href="#dialog_07_mcd">conceptuel</a> / <a class="dialog_toggler" href="#dialog_07_mpd">physique</a></span></li>
                    <li class="fragment diapo__item">Indexes : <span class="diapo__item__content">requ√™tes g√©ospatiales
                            (geoNear, 2d sphere)</span></li>
                    <li class="fragment diapo__item">Collections cl√©s : <span class="diapo__item__content">caches /
                            user_challenges / progress</span></li>
                </ul>
                <dialog class="dialog" id="dialog_07_ea_simple">
                    <h3 class="dialog__title">Diagramme Entit√©s-Associations simplifi√©</h3>
                    <div class="dialog__content">
                        <img src="assets/07/diagramme_ea.svg" alt="Diagramme E/A" width="1568" height="570" />
                    </div>
                </dialog>
                <dialog class="dialog" id="dialog_07_mcd">
                    <h3 class="dialog__title">Mod√®le conceptuel de donn√©es</h3>
                    <div class="dialog__content">
                        <img src="assets/07/mcd.svg" alt="MCD" width="1568" height="1646" />
                    </div>
                </dialog>
                <dialog class="dialog" id="dialog_07_mpd">
                    <h3 class="dialog__title">Mod√®le physique de donn√©es</h3>
                    <div class="dialog__content">
                        <img src="assets/07/mpd.svg" alt="MPD" width="1568" height="1108" />
                    </div>
                </dialog>
                <aside class="notes">
                    Diagramme : <a href="assets/07/mcd.svg">MCD</a> / <a href="assets/07/mpd.svg">MPD</a><br>
                    Indexes : <a href="assets/07/seed_indexes.py.txt">seed_indexes</a>, expliquer l'importance de l'index
                    2d sphere<br>
                    Collections : caches / user challenges / progress. Si on montre des collections d√©normalis√©es, on le
                    dit ouvertement
                </aside>
            </section>

            <section>
                <h2>Cas d‚Äôutilisation</h2>
                <ul>
                    <li class="fragment diapo__item">Diagramme des cas : <span class="diapo__item__content"><a class="dialog_toggler" href="#dialog_08_cas_utilisation">liste des cas</a></span></li>
                    <li class="fragment diapo__item">Parcours : <span class="diapo__item__content">importer GPX => g√©rer
                            challenges => suivre progression => identifier targets</span></li>
                </ul>
                <dialog class="dialog" id="dialog_08_cas_utilisation">
                    <h3 class="dialog__title">Diagramme des cas d'utilisation</h3>
                    <div class="dialog__content">
                        <img src="assets/08/diagramme_de_cas.svg" alt="Diagramme des cas" width="754" height="1510" />
                    </div>
                </dialog>
                <aside class="notes">
                    <a href="assets/08/diagramme-cas.svg">Diagramme des cas</a><br>
                    <a href="assets/08/parcours-import.svg">Parcours import GPX</a>
                </aside>
            </section>

            <section>
                <h2>Diagrammes de s√©quence</h2>
                <ul>
                    <li class="fragment diapo__item"><a class="dialog_toggler" href="#dialog_09_importgpx">Import GPX</a></li>
                    <li class="fragment diapo__item"><a class="dialog_toggler" href="#dialog_09_progression">Calcul de progression</a></li>
                </ul>
                <dialog class="dialog" id="dialog_09_importgpx">
                    <h3 class="dialog__title">Diagramme de s√©quence : Import GPX</h3>
                    <div class="dialog__content">
                        <img src="assets/09/diagramme_sequence_import_gpx.svg" alt="Import GPX" width="1568" height="1130" />
                    </div>
                </dialog>
                <dialog class="dialog" id="dialog_09_progression">
                    <h3 class="dialog__title">Diagramme de s√©quence : Calcul de progression</h3>
                    <div class="dialog__content">
                        <img src="assets/09/diagramme_sequence_progression.svg" alt="Calcul de progression" width="1568" height="1454" />
                    </div>
                </dialog>
                <aside class="notes">
                    <a href="assets/09/diagramme-sequence.svg">Diagramme de s√©quence</a><br>
                    <a href="assets/09/evaluation-taches.png">√âvaluation t√¢ches</a>
                </aside>
            </section>

            <section>
                <h2>UI ‚Äî Carte interactive</h2>
                <ul>
                    <li class="fragment diapo__item">Screenshots <a class="dialog_toggler" href="#dialog_10_map_desktop">desktop</a> + <a class="dialog_toggler" href="#dialog_10_map_mobile">mobile</a></li>
                    <li class="fragment diapo__item">Composant MapBase.vue : <span class="diapo__item__content"><a class="dialog_toggler" href="#dialog_10_mapbase">Leaflet,
                            clustering, tile caching</a></span></li>
                    <li class="fragment diapo__item">Performance &amp; green computing</li>
                </ul>
                <dialog class="dialog" id="dialog_10_map_desktop">
                    <h3 class="dialog__title">Carte interactive : desktop</h3>
                    <div class="dialog__content">
                        <img src="assets/10/map_desktop.png" alt="Map desktop" width="1920" height="936" />
                    </div>
                </dialog>
                <dialog class="dialog" id="dialog_10_map_mobile">
                    <h3 class="dialog__title">Carte interactive : mobile</h3>
                    <div class="dialog__content">
                        <img src="assets/10/map_mobile.png" alt="Map mobile" width="360" height="800" />
                    </div>
                </dialog>
                <dialog class="dialog" id="dialog_10_mapbase">
                    <h3 class="dialog__title">MapBase.vue</h3>
                    <div class="dialog__content">
                        <code>
                            <pre>
                              &lt;template&gt;
                                &lt;!-- le parent de MapBase doit &ecirc;tre positionn&eacute; (relative/absolute) ; ici on remplit --&gt;
                                &lt;div                                  
                                  ref=&quot;el&quot;
                                  class=&quot;absolute inset-0&quot;
                                /&gt;
                              &lt;/template&gt;
                              
                              &lt;script setup lang=&quot;ts&quot;&gt;
                              import { ref, onMounted, onBeforeUnmount, computed, watch, defineEmits, defineExpose } from &quot;vue&quot;;
                              import L from 'leaflet'
                              import { installCrosshairPicker, type CrosshairPicker } from &quot;./crosshairPicker&quot;;
                              import { useAuthStore } from '@/store/auth'
                              
                              type LatLng = [number, number] // [lat, lng]
                              const props = defineProps&lt;{ center?: LatLng; zoom?: number; attribution?: string }&gt;()
                              
                              const emit = defineEmits&lt;{
                                  (e: &quot;ready&quot;, map: L.Map): void;
                                  (e: &quot;pick&quot;, payload: { lat: number; lng: number }): void;
                                  (e: &quot;centerChanged&quot;, payload: { lat: number; lng: number; coords: string }): void; // &larr; AJOUT ICI
                              }&gt;();
                              const el = ref&lt;HTMLDivElement | null&gt;(null)
                              let map: L.Map | null = null
                              let picker: CrosshairPicker | null = null;
                              const auth = useAuthStore()
                              
                              const fallbackCenter: LatLng = [46.6, 2.6]  // France approx
                              const initialZoom = computed(() =&gt; props.zoom ?? 6)
                              const attribution = computed(
                                  () =&gt; props.attribution ?? '&copy; OpenStreetMap contributors'
                              )
                              
                              // Fonction pour formater les coordonn&eacute;es
                              function formatCoords(lat: number, lng: number): string {
                                  const latDir = lat &gt;= 0 ? 'N' : 'S'
                                  const lngDir = lng &gt;= 0 ? 'E' : 'W'
                              
                                  const latDeg = Math.floor(Math.abs(lat))
                                  const latMin = ((Math.abs(lat) - latDeg) * 60).toFixed(3)
                              
                                  const lngDeg = Math.floor(Math.abs(lng))
                                  const lngMin = ((Math.abs(lng) - lngDeg) * 60).toFixed(3)
                              
                                  return `${latDir}${latDeg} ${latMin} ${lngDir}${lngDeg} ${lngMin}`
                              }
                              
                              // Fonction pour &eacute;mettre le centre actuel
                              function emitCurrentCenter() {
                                  if (!map) return
                              
                                  const center = map.getCenter()
                                  const coords = formatCoords(center.lat, center.lng)
                              
                                  emit('centerChanged', {
                                      lat: center.lat,
                                      lng: center.lng,
                                      coords
                                  })
                              }
                              
                              function currentCenter(): LatLng {
                                  if (props.center) return props.center
                                  const loc = auth.user?.location
                                  console.log(&quot;loc&quot;, loc)
                                  if (loc &amp;&amp; Number.isFinite(loc.lat) &amp;&amp; Number.isFinite(loc.lon)) {
                                      console.log(&quot;loc found&quot;, loc.lat, loc.lon)
                                      return [loc.lat, loc.lon]
                                  }
                                  return fallbackCenter
                              }
                              
                              function tileUrl() {
                                  const retina = L.Browser.retina ? '@2x' : ''
                                  return `/tiles/{z}/{x}/{y}${retina}.png`
                              }
                              
                              // --- listener resize d&eacute;fini au niveau module pour pouvoir le retirer proprement ---
                              const onResize = () =&gt; map?.invalidateSize(true);
                              
                              function init() {
                                  if (!el.value) return;
                                  map = L.map(el.value, { zoomControl: true });
                                  L.tileLayer(tileUrl(), { maxZoom: 19, attribution: attribution.value }).addTo(map);
                                  map.setView(currentCenter(), initialZoom.value);
                                  // (si tu n&rsquo;en as pas besoin, tu peux retirer cet emit de click)
                                  // map.on(&quot;click&quot;, (ev) =&gt; emit(&quot;click&quot; as any, ev));
                              
                                  emit(&quot;ready&quot;, map);              // ‚úÖ on garde CE emit
                                  setTimeout(() =&gt; map?.invalidateSize(true), 0);
                              }
                              
                              // remplace ta logique de watch/recenter par ceci :
                              
                              let recentered = false
                              
                              function tryRecenterOnce() {
                                  if (!map || recentered) return
                                  // priorit&eacute; au prop center, sinon user.location, sinon rien
                                  const fromProp = props.center
                                  const fromUser = auth.user?.location
                                  const target =
                                      (fromProp &amp;&amp; Number.isFinite(fromProp[0]) &amp;&amp; Number.isFinite(fromProp[1]))
                                          ? fromProp
                                          : (fromUser &amp;&amp; Number.isFinite(fromUser.lat) &amp;&amp; Number.isFinite(fromUser.lon))
                                              ? [fromUser.lat, fromUser.lon] as [number, number]
                                              : null
                              
                                  if (target) {
                                      map.setView(target, initialZoom.value)
                                      recentered = true
                                      emitCurrentCenter()
                                  }
                              }
                              
                              onMounted(() =&gt; {
                                  init()
                                  window.addEventListener(&quot;resize&quot;, onResize);
                              
                                  // Crosshair picker install&eacute; mais inactif tant qu&rsquo;on ne l&rsquo;active pas
                                  if (map) {
                                      picker = installCrosshairPicker(map, (ll) =&gt; {
                                          emit(&quot;pick&quot;, { lat: ll.lat, lng: ll.lng });
                                      });
                              
                                      // &Eacute;couter les mouvements de carte
                                      map.on('moveend', () =&gt; {
                                          emitCurrentCenter()
                                      })
                                  }
                                  
                                  onBeforeUnmount(() =&gt; window.removeEventListener('resize', onResize))
                                  // ‚ûï Ajout non intrusif du picker (d&eacute;sactiv&eacute; par d&eacute;faut)
                              
                                  tryRecenterOnce()
                              })
                              
                              onBeforeUnmount(() =&gt; {
                                  window.removeEventListener(&quot;resize&quot;, onResize);
                                  if (picker) picker.destroy();
                                  if (map) {
                                      map.remove();
                                      map = null;
                                  }
                              });
                              
                              // ‚ûï Exposer des m&eacute;thodes au parent (pour d&eacute;clencher depuis un bouton)
                              function enablePick() {
                                  console.log(&quot;[MapBase] enablePick()&quot;);
                                  console.log(&quot;[MapBase] picker is&quot;, picker);
                              
                                  picker?.enable();
                              }
                              function disablePick() {
                                  console.log(&quot;[MapBase] disablePick()&quot;);
                                  picker?.disable();
                              }
                              defineExpose({ getMap: () =&gt; map, enablePick, disablePick });
                              
                              // üëâ r&eacute;agir si le center prop change (par ex. via une recherche)
                              watch(() =&gt; props.center, () =&gt; {
                                  // on autorise un re-center si c&rsquo;est un center &ldquo;externe&rdquo;
                                  recentered = false
                                  tryRecenterOnce()
                              })
                              
                              // üëâ r&eacute;agir si la localisation utilisateur arrive/apr&egrave;s-coup
                              watch(() =&gt; auth.user?.location, () =&gt; {
                                  // seulement si on n&rsquo;a pas encore recadr&eacute; via user
                                  tryRecenterOnce()
                              })
                              &lt;/script&gt;
                            </pre>

                        </code>>
                    </div>
                </dialog>
                <aside class="notes">
                    <a href="assets/10/map_mobile.png">Mobile</a><br>
                    <a href="assets/10/map_desktop.png">Desktop</a><br>
                    <a href="assets/10/tiles.conf.txt">Tiles caching</a>
                </aside>
            </section>

            <section>
                <h2>UI ‚Äî Liste challenges</h2>
                <ul>
                    <li class="fragment diapo__item"><a class="dialog_toggler" href="#dialog_11_challenges_list">Filtrage, pagination, statuts, barre d‚Äôactions</a></li>
                    <li class="fragment diapo__item">Composant Vue + Pinia</li>
                </ul>
                <dialog class="dialog" id="dialog_11_challenges_list">
                    <h3 class="dialog__title">User challenges : liste</h3>
                    <div class="dialog__content">
                        <img src="assets/11/user_challenges_list.png" alt="User challenges list" width="360" height="800" />
                    </div>
                </dialog>
                <aside class="notes">
                    <a href="assets/11/challenges_list.vue.txt">Liste challenges</a><br>
                </aside>
            </section>

            <section>
                <h2>UI ‚Äî D√©tails challenge</h2>
                <ul>
                    <li class="fragment diapo__item"><a class="dialog_toggler" href="#dialog_12_challenge_details">Structure de page</a></li>
                    <li class="fragment diapo__item">Description sanitis√©e (DOMPurify)</li>
                    <li class="fragment diapo__item">Notes &amp; override</li>
                    <li class="fragment diapo__item">Progression agr√©g√©e + t√¢ches</li>
                </ul>
                <dialog class="dialog" id="dialog_12_challenge_details">
                    <h3 class="dialog__title">User challenge : details</h3>
                    <div class="dialog__content">
                        <img src="assets/12/user_challenge_details.png" alt="User challenge details" width="726" height="1197" />
                    </div>
                </dialog>
                <aside class="notes">
                    <a href="assets/12/challenge_details.vue.txt">Challenge, d√©tails</a>
                </aside>
            </section>

            <section>
                <h2>Composant m√©tier ‚Äî Parser GPX</h2>
                <ul>
                    <li class="fragment diapo__item">GPXCacheParser.py ‚Äî multi-namespaces (‚â•5 standards)</li>
                    <li class="fragment diapo__item">Extraction : <span class="diapo__item__content">attributs,
                            m√©tadonn√©es, validation stricte</span></li>
                </ul>
                <aside class="notes">
                    <a href="assets/13/gpx-parser.png">Parser GPX</a>
                </aside>
            </section>

            <section>
                <h2>Composant m√©tier ‚Äî Moteur AST</h2>
                <ul>
                    <li class="fragment diapo__item">Grammaire AST (conditions / agr√©gats)</li>
                    <li class="fragment diapo__item">Compilation => requ√™tes MongoDB (QueryBuilder)</li>
                </ul>
                <aside class="notes">
                    <a href="assets/14/ast-grammaar.png">Grammaire AST</a><br>
                    <a href="assets/14/ast-to-query.png">Compilation AST requ√™te</a>
                </aside>
            </section>

            <section>
                <h2>Acc√®s donn√©es ‚Äî Recherche g√©ospatiale</h2>
                <ul>
                    <li class="fragment diapo__item">$geoNear + index 2dsphere</li>
                    <li class="fragment diapo__item">Pipelines d‚Äôagr√©gation, pagination, projection compacte</li>
                </ul>
                <aside class="notes">
                    <a href="assets/15/2dsphere.png">Index 2d sphere</a><br>
                    <a href="assets/15/query-optimization.png">Optimisation g√©ospatiale</a>
                </aside>
            </section>

            <section>
                <h2>Acc√®s donn√©es ‚Äî Calcul progression</h2>
                <ul>
                    <li class="fragment diapo__item">evaluate_progress() : <span class="diapo__item__content">snapshots
                            + s√©ries temporelles</span></li>
                    <li class="fragment diapo__item">MAJ statuts tasks/challenges</li>
                </ul>
                <aside class="notes">
                    <a href="assets/16/evaluate_progress.png">evaluate progress</a>
                </aside>
            </section>

            <section>
                <h2>Autre composant ‚Äî Provider altim√©trie</h2>
                <ul>
                    <li class="fragment diapo__item">OpenTopoData : <span class="diapo__item__content">quotas,
                            rate-limiting, batch intelligent</span></li>
                    <li class="fragment diapo__item">Tol√©rance aux erreurs (None localis√©s), caching</li>
                </ul>
                <aside class="notes">
                    <a href="assets/17/opentopodata.png">OpenTopo Data</a>
                </aside>
            </section>

            <section>
                <h2>S√©curit√© ‚Äî Authentification</h2>
                <ul>
                    <li class="fragment diapo__item">JWT + refresh tokens (rotation)</li>
                    <li class="fragment diapo__item">Sch√©ma de flow, r√¥les user/admin</li>
                </ul>
                <aside class="notes">
                    <a href="assets/18/tokens.png">Tokens</a><br>
                    <a href="assets/18/flow.svg">Authentication flow</a>
                </aside>
            </section>

            <section>
                <h2>S√©curit√© ‚Äî Protection multicouche</h2>
                <ul>
                    <li class="fragment diapo__item">Validation Pydantic stricte</li>
                    <li class="fragment diapo__item">Sanitisation HTML (XSS), CORS</li>
                    <li class="fragment diapo__item">Rate limiting (client + OSM), isolation par utilisateur</li>
                </ul>
                <aside class="notes">
                    <a href="assets/19/pydantic.png">Pydantic</a><br>
                    <a href="assets/19/sanitization.png">Sanitisation HTML</a><br>
                    <a href="assets/19/rate-limiting.png">Rate limiting</a>
                </aside>
            </section>

            <section>
                <h2>Plan de tests</h2>
                <ul>
                    <li class="fragment diapo__item">Pyramide : <span class="diapo__item__content">80% unit / 15% integ
                            / 5% E2E</span></li>
                    <li class="fragment diapo__item">Outils : <span class="diapo__item__content">Pytest / Vitest /
                            Playwright</span></li>
                    <li class="fragment diapo__item">Coverage vis√© : &gt;70%</li>
                </ul>
                <aside class="notes">
                    <a href="assets/20/pytest.png">Pytest</a><br>
                    <a href="assets/20/Vitest.png">Vitest</a><br>
                    <a href="assets/20/playwright.png">Playwright</a><br>
                    <a href="assets/20/coverage.png">Coverage</a>
                </aside>
            </section>

            <section>
                <h2>Jeu d‚Äôessai</h2>
                <ul>
                    <li class="fragment diapo__item">5 fichiers GPX (attendus vs obtenus)</li>
                    <li class="fragment diapo__item">Validation import, pays/r√©gions/challenges, 413 sur &gt;20Mo</li>
                </ul>
                <aside class="notes">
                    <a href="assets/21/jeu-essai.png">Jeu d'essai</a><br>
                    <a href="assets/21/import.png">Imoprt GPX</a>
                </aside>
            </section>

            <section>
                <h2>Veille vuln√©rabilit√©s</h2>
                <ul>
                    <li class="fragment diapo__item">CVE : <span class="diapo__item__content">suivi / proc√©dures
                            correctives</span></li>
                    <li class="fragment diapo__item">Audits s√©curit√© : <span class="diapo__item__content">pip-audit, npm
                            audit</span></li>
                    <li class="fragment diapo__item">Bonnes pratiques : <span class="diapo__item__content">defense in
                            depth, fail secure</span></li>
                </ul>
                <aside class="notes">
                    <a href="assets/22/cve.png">CVE</a><br>
                    <a href="assets/22/audits.png">Audits</a><br>
                    <a href="assets/22/bonnes-pratiques.png">Bonnes pratiques</a>
                </aside>
            </section>

            <section>
                <h2>Conclusion</h2>
                <ul>
                    <li class="fragment diapo__item">Comp√©tences CDA couvertes : <span class="diapo__item__content">3
                            blocs / 11 comp√©tences</span></li>
                    <li class="fragment diapo__item">Difficult√©s &amp; solutions, retours testeurs</li>
                    <li class="fragment diapo__item">Perspectives : <span class="diapo__item__content">offline,
                            application native, API Geocaching.com, IA ciblage</span></li>
                </ul>
                <aside class="notes">
                    <a href="assets/23/competences.png">Comp√©tences CDA</a><br>
                    <a href="assets/23/difficultes.png">Difficult√©s / Solutions / Retours</a>
                </aside>
            </section>

            <section>
                <h2>Merci / Questions</h2>
            </section>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/reveal.js@5.2.1/dist/reveal.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reveal.js@5.2.1/plugin/notes/notes.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reveal.js-mermaid-plugin@11.4.1/plugin/mermaid/mermaid.js"></script>
    <script type="module">
        //import RevealMermaid from "https://unpkg.com/reveal.js/plugin/mermaid/mermaid.esm.js";
        Reveal.initialize({
            hash: true,
            slideNumber: 'c/t',
            transition: 'slide',     // request #1: movement (slide) instead of fade
            transitionSpeed: 'default',
            controls: true,
            progress: true,
            center: true,
            defaultTiming: 87,
            plugins: [RevealNotes, RevealMermaid],
            mermaid: { startOnLoad: true }
        });;
    </script>
    <script>
        // Version plus concise avec gestion d'erreur am√©lior√©e
        function initDialogTogglers() {
            document.querySelectorAll('.dialog_toggler').forEach(toggler => {
                toggler.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = toggler.getAttribute('href')?.replace('#', '');
                    const dialog = document.getElementById(targetId);

                    if (dialog?.tagName === 'DIALOG') {
                        // Ouvre le dialogue en mode plein √©cran
                        dialog.showModal();

                        // Ferme le dialogue au clic n'importe o√π
                        dialog.addEventListener('click', function closeOnClick(e) {
                            dialog.close();
                            // On retire l'event listener apr√®s fermeture
                            dialog.removeEventListener('click', closeOnClick);
                        });
                    }
                });
            });
        }

        document.addEventListener('DOMContentLoaded', initDialogTogglers);
    </script>
</body>

</html>